"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_get=function(e,t,n){for(var r=!0;r;){var a=e,u=t,l=n;i=f=o=void 0,r=!1,null===a&&(a=Function.prototype);var i=Object.getOwnPropertyDescriptor(a,u);if(void 0!==i){if("value"in i)return i.value;var o=i.get;return void 0===o?void 0:o.call(l)}var f=Object.getPrototypeOf(a);if(null===f)return void 0;e=f,t=u,n=l,r=!0}},_react=require("react"),_react2=_interopRequireDefault(_react),_ShuffleItem=require("./ShuffleItem"),_ShuffleItem2=_interopRequireDefault(_ShuffleItem),_materialUi=require("material-ui"),_materialUi2=_interopRequireDefault(_materialUi),_materialUiLibSvgIconsContentAdd=require("material-ui/lib/svg-icons/content/add"),_materialUiLibSvgIconsContentAdd2=_interopRequireDefault(_materialUiLibSvgIconsContentAdd),_reactTapEventPlugin=require("react-tap-event-plugin"),_reactTapEventPlugin2=_interopRequireDefault(_reactTapEventPlugin),_storeShuffleItemStore=require("../../store/ShuffleItemStore"),_storeShuffleItemStore2=_interopRequireDefault(_storeShuffleItemStore),_actionsShuffle=require("../../actions/Shuffle"),_actionsShuffle2=_interopRequireDefault(_actionsShuffle),_path=require("path"),_path2=_interopRequireDefault(_path),_utilsFileWriter=require("../../utils/FileWriter"),_utilsFileWriter2=_interopRequireDefault(_utilsFileWriter);_reactTapEventPlugin2["default"]();var ThemeManager=new _materialUi2["default"].Styles.ThemeManager;ThemeManager.setTheme(ThemeManager.types.LIGHT);var dirHome=process.env["win32"==process.platform?"USERPROFILE":"HOME"],defaultPath=_path2["default"].join(dirHome,"Desktop"),shufflePoints=[{payload:1,text:"Continuity"},{payload:2,text:"Fix"}],styles={cardStyle:{display:"flex",flexDirection:"column",marginBottom:20,marginTop:20,marginLeft:20,marginRight:10},numberOfCardsStyle:{marginLeft:20},numberOfExecutionStyle:{marginLeft:20},bottomContainer:{display:"flex",justifyContent:"space-between"},executionButtonStyle:{marginTop:10,marginRight:10},executionSecondsLabelStyle:{marginTop:10}},ShuffleMenu=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.state={shuffleItems:[],checkNumberOfCards:0,execution:0,executionSeconds:2,checkCardErrorText:"",executionErrorText:"",shuffleEnabled:!1,outputPath:defaultPath}}return _inherits(t,e),_createClass(t,[{key:"componentWillMount",value:function(){this.state.shuffleItems.length<=0&&this.setState({shuffleItems:[this.renderShuffleItem(0,!1)],executionSeconds:2})}},{key:"componentDidMount",value:function(){_storeShuffleItemStore2["default"].addChangeListener(this.handleItemChange.bind(this))}},{key:"componentWillUnmount",value:function(){_storeShuffleItemStore2["default"].removeChangeListener(this.handleItemChange.bind(this))}},{key:"componentDidUpdate",value:function(e,t){_storeShuffleItemStore2["default"].getConditions()}},{key:"getChildContext",value:function(){return{muiTheme:ThemeManager.getCurrentTheme()}}},{key:"render",value:function(){var e=this.state.shuffleItems.length>0?this.state.shuffleItems:this.renderShuffleItem(0,!1);return _react2["default"].createElement("div",{className:"shuffles"},e,this.renderAddButton(),this.renderCheckNumberOfCardsField(),this.renderShuffleNumberOfExecutionsField(),_react2["default"].createElement("div",{style:styles.bottomContainer},this.renderExecutionSecondsLabel(),this.renderExecutionButton()),_react2["default"].createElement(_materialUi.Snackbar,{message:"Shuffles Complete",autoHideDuration:3e3,ref:"snack"}))}},{key:"renderShuffleItem",value:function(e,t){return _react2["default"].createElement(_ShuffleItem2["default"],{style:styles.cardStyle,cardId:e,showRemoveButton:t,removeHandler:this.handleItemRemove.bind(this)})}},{key:"renderAddButton",value:function(){return _react2["default"].createElement("div",{className:"add-button"},_react2["default"].createElement(_materialUi.FloatingActionButton,{onClick:this.handleAddButtonClick.bind(this),primary:!0},_react2["default"].createElement(_materialUiLibSvgIconsContentAdd2["default"],null)))}},{key:"renderCheckNumberOfCardsField",value:function(){return _react2["default"].createElement(_materialUi.TextField,{style:styles.numberOfCardsStyle,floatingLabelText:"Check number of cards",errorText:this.state.checkCardErrorText,onChange:this.handleCheckNumberOfCardsChange.bind(this)})}},{key:"renderShuffleNumberOfExecutionsField",value:function(){return _react2["default"].createElement(_materialUi.TextField,{style:styles.numberOfExecutionStyle,floatingLabelText:"Shuffle number of execution",errorText:this.state.executionErrorText,onChange:this.handleShuffleNumberOfExecutionChange.bind(this)})}},{key:"renderExecutionButton",value:function(){return _react2["default"].createElement(_materialUi.RaisedButton,{style:styles.executionButtonStyle,disabled:!this.state.shuffleEnabled,label:"Shuffle!",secondary:!0,onClick:this.handleShuffleButtonClick.bind(this)})}},{key:"renderExecutionSecondsLabel",value:function(){return _react2["default"].createElement(_materialUi.FlatButton,{style:styles.executionSecondsLabelStyle,label:this.state.executionSeconds+"  seconds",disabled:!0})}},{key:"renderOutPutFilePath",value:function(){return _react2["default"].createElement(_materialUi.RaisedButton,{secondary:!0,label:"Path Select"},_react2["default"].createElement("input",{type:"file",onChange:this.handlePathChange.bind(this)}))}},{key:"handleAddButtonClick",value:function(e){var t=this.state.shuffleItems.length,n=this.state.shuffleItems;n[t]=this.renderShuffleItem(t,!0),this.setState({shuffleItems:n,executionSeconds:this.state.executionSeconds+2})}},{key:"handleShuffleButtonClick",value:function(e){var t=_storeShuffleItemStore2["default"].getConditions(),n=_actionsShuffle2["default"].shuffleStart(t,this.state.execution,[]),r=this._calcAllShuffleTimes(),a=this._calcAllShuffleSeconds(),u=this._calcShuffleTypeNumber(),l="Types: "+u+", AllShuffleTimes: "+r+", AllShuffleSeconds: "+a+", CheckNumberOfCards: "+this.state.checkNumberOfCards+", ExecutionTimes: "+this.state.execution+"\n",i=n.string+l;_utilsFileWriter2["default"].writeString(i,"all"),this.refs.snack.show()}},{key:"handleCheckNumberOfCardsChange",value:function(e){var t=e.target.value;if(t.match(/[^0-9]+/))return void this.setState({checkCardErrorText:"Please input number",checkNumberOfCards:0,shuffleEnabled:!1});if(t>52&&t)return void this.setState({checkCardErrorText:"Out of range",checkNumberOfCards:0,shuffleEnabled:!1});var n=_storeShuffleItemStore2["default"].getEnabledShuffleItems(),r=n&&this.state.execution>0&&t>0;this.setState({checkCardErrorText:"",checkNumberOfCards:t,shuffleEnabled:r})}},{key:"handleShuffleNumberOfExecutionChange",value:function(e){var t=e.target.value;if(t.match(/[^0-9]+/))return void this.setState({executionErrorText:"Please input number",execution:0,shuffleEnabled:!1,executionSeconds:0});var n=_storeShuffleItemStore2["default"].getEnabledShuffleItems(),r=n&&t>0&&this.state.checkNumberOfCards>0,a=this._calcAllShuffleSeconds(t);this.setState({executionErrorText:"",execution:t,shuffleEnabled:r,executionSeconds:a})}},{key:"handleItemRemove",value:function(e,t){var n=this.state.shuffleItems;n.splice(t,1),this.setState({suffleItems:n,executionSeconds:3*n.length})}},{key:"handleItemChange",value:function(){this._updateEnabled()}},{key:"handlePathChange",value:function(e){var t=e.target.value;this.setState({outputPath:t})}},{key:"_updateEnabled",value:function(){var e=_storeShuffleItemStore2["default"].getEnabledShuffleItems(),t=e&&this.state.execution>0&&this.state.checkNumberOfCards>0,n=this._calcAllShuffleSeconds();this.setState({shuffleEnabled:t,executionSeconds:n})}},{key:"_calcAllShuffleTimes",value:function(){var e=_storeShuffleItemStore2["default"].getConditions(),t=this.state.execution;return e.map(function(e){return e.shuffleTimes}).reduce(function(e,t){return e+t},0)*t}},{key:"_calcAllShuffleSeconds",value:function(e){var t=_storeShuffleItemStore2["default"].getConditions(),n=void 0===e?this.state.execution:e;return t.map(function(e){return e.shuffleTimes*e.shuffleSeconds}).reduce(function(e,t){return e+t},0)*n}},{key:"_calcShuffleTypeNumber",value:function(){var e=_storeShuffleItemStore2["default"].getConditions(),t=e.filter(function(e){return"cut"===e.shuffleType}).length,n=e.filter(function(e){return"hindu"===e.shuffleType}).length,r=e.filter(function(e){return"faro"===e.shuffleType}).length,a=e.filter(function(e){return"deal"===e.shuffleType}).length;return[t,n,r,a].filter(function(e){return e>0}).length}}],[{key:"childContextTypes",value:{muiTheme:_react2["default"].PropTypes.object},enumerable:!0}]),t}(_react2["default"].Component);module.exports=ShuffleMenu;