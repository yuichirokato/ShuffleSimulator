"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,r,l){return r&&e(t.prototype,r),l&&e(t,l),t}}(),_storeSettingsStore=require("../store/SettingsStore"),_storeSettingsStore2=_interopRequireDefault(_storeSettingsStore),_utilsFileWriter=require("../utils/FileWriter"),_utilsFileWriter2=_interopRequireDefault(_utilsFileWriter),flatten=function(e){return console.log("flatten: "+JSON.stringify(e)),Array.prototype.concat.apply([],e)},middleIndex=0,gloabalIndex=0,maxTimes=0,localMaxTimes=0,itemResults=[],localResults=[],results=[],isDisplayProcess=_storeSettingsStore2["default"].getEachDisplay(),Shuffle=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"shuffleStart",value:function(e,t,r){var l=r;if(0>=t){var a=results.reduce(function(e,t){return e+t},"");return{deck:s,string:a}}0===r.length&&(l=this._createDeck(),maxTimes=t),gloabalIndex=maxTimes-t;var s=this._localShuffle(e,l);return results[results.length]=localResults.join(","),localResults=[],this.shuffleStart(e,t-1,s)}},{key:"_localShuffle",value:function(e,t){{var r=this,l=t;_storeSettingsStore2["default"].getEachDisplay()}return[].concat(_toConsumableArray(Array(e.length).keys())).forEach(function(t){var a=e[t];console.log("type: "+JSON.stringify(a)),middleIndex=t,l=r._shuffleRouter(a,l);var s=_utilsFileWriter2["default"].arrayToCsvString(l),n=_utilsFileWriter2["default"].createSettingsTemplate(a);localResults[localResults.length]=n+s}),l}},{key:"_shuffleRouter",value:function(e,t){console.log("condition: "+JSON.stringify(e));var r=e.shuffleType;if("cut"===r){var l=e.fromRange,a=e.toRange,s=e.startIsRandom,n=e.shuffleTimes;return this._cutShuffle(l,a,s,n,t)}if("hindu"===r){var l=e.fromRange,a=e.toRange,i=e.endFromRange,u=e.endToRange,s=e.startIsRandom,o=e.endIsRandom,n=e.shuffleTimes;return this._hinduShuffle(l,a,i,u,s,o,n,t)}if("faro"===r){var n=e.shuffleTimes;return this._faroShuffle(n,t)}if("deal"===r){var l=e.fromRange,a=e.toRange,s=e.startIsRandom,n=e.shuffleTimes;return this._dealShuffle(l,a,s,n,t)}}},{key:"_cutShuffle",value:function(e,t,r,l,a){if(0>=l)return itemResults=[],i;var s=r?this._createRandom():this._createRandom(e,t),n=a.slice(0,s),i=a.slice(s).concat(n);itemResults.length<=0&&(localMaxTimes=l);var u=localMaxTimes-l;if(isDisplayProcess){console.log("cut isDisplay True!");var o="cut-"+gloabalIndex+"-"+middleIndex+"-"+u,f={shuffleType:"cut",fromRange:e,toRange:t,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(i,f,o)}return itemResults[itemResults.length]=u,this._cutShuffle(e,t,r,l-1,i)}},{key:"_hinduShuffle",value:function(e,t,r,l,a,s,n,i){if(0>=n)return itemResults=[],i;var u=a?this._createRandom():this._createRandom(e,t),o=s?this._createRandom():this._createRandom(r,l);if(u>o||e>u||u>t||r>o||o>l)return console.log("やり直し！"),this._hinduShuffle(e,t,r,l,a,s,n,i);itemResults.length<=0&&(localMaxTimes=n);var f=localMaxTimes-n,c=i.slice(u-1,o),h=i.slice(o),m=i.slice(0,u-1),d=flatten([c,m,h]);if(isDisplayProcess){var g="hindu-"+gloabalIndex+"-"+middleIndex+"-"+f,y={shuffleType:"hindu",fromRange:e,toRange:t,endFromRange:r,endToRange:l,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(d,y,g)}return itemResults[itemResults.length]=f,this._hinduShuffle(e,t,r,l,a,s,n-1,d)}},{key:"_faroShuffle",value:function(e,t){if(0>=e)return itemResults=[],s;var r=t.length/2,l=t.slice(0,r),a=t.slice(r),s=[],n=0,i=0;itemResults.length<=0&&(localMaxTimes=e);for(var u=1;u<t.length+1;u++)1===u||u%2!==0?(s[u-1]=a[i],i++):(s[u-1]=l[n],n++);var o=localMaxTimes-e;if(isDisplayProcess){var f="faro-"+gloabalIndex+"-"+middleIndex+"-"+o,c={shuffleType:"faro",shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(s,c,f)}return itemResults[itemResults.length]=o,this._faroShuffle(e-1,s)}},{key:"_dealShuffle",value:function(e,t,r,l){var a=this;if(0>=r)return itemResults=[],flatten(l);var s=this._createRandom(e,t),n=(this._createEmptyDecks(s),l.length%s);if(console.log("num: "+s),console.log("deck: "+JSON.stringify(l)),e>s||s>t)return console.log("やり直し！"),this._dealShuffle(e,t,r,l);if(itemResults.length<=0&&(localMaxTimes=r),1===s){if(l.reverse(),isDisplayProcess){var i="deal-"+gloabalIndex+"-"+middleIndex+"-"+index,u={shuffleType:"deal",fromRange:e,toRange:t,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(l,u,i)}return itemResults[itemResults.length]=index,this._dealShuffle(e,t,r-1,l)}var o=[].concat(_toConsumableArray(Array(s).keys())).map(function(e){return a._getSubDeckIndex(e,s).map(function(e){return l[e]})});if(console.log("result: "+JSON.stringify(o)),n&&!function(){var e=l.length-n;[].concat(_toConsumableArray(Array(n).keys())).forEach(function(t){var r=o[t].length;o[t][r]=l[e],e++})}(),isDisplayProcess){var i="deal-"+gloabalIndex+"-"+middleIndex+"-"+index,u={shuffleType:"deal",fromRange:e,toRange:t,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(flatten(o),u,i)}return itemResults[itemResults.length]=index,this._dealShuffle(e,t,r-1,flatten(o))}},{key:"_createDeck",value:function(){var e=["spade","club","heart","dia"],t=flatten(e.map(function(e){return Array.from(Array(13).keys()).map(function(t){return{sute:e,number:t+1}})}));return t}},{key:"_createRandom",value:function(e,t){if(console.log("fromNum: "+e),console.log("toNum: "+t),void 0===e||void 0===t){var r=Math.floor(51*Math.random()+1);return console.log("result: "+r),r}var l=Math.floor(Math.random()*(t-e)+e);return l}},{key:"_createEmptyDecks",value:function(e){return[].concat(_toConsumableArray(Array(e).keys())).map(function(e){return[]})}},{key:"_getSubDeckIndex",value:function(e,t){var r=deck.length/t;return[].concat(_toConsumableArray(Array(r+1).keys())).map(function(r){return e+t*r})}}]),e}();exports["default"]=new Shuffle,module.exports=exports["default"];