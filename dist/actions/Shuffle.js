"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,r,l){return r&&e(t.prototype,r),l&&e(t,l),t}}(),_storeSettingsStore=require("../store/SettingsStore"),_storeSettingsStore2=_interopRequireDefault(_storeSettingsStore),_utilsFileWriter=require("../utils/FileWriter"),_utilsFileWriter2=_interopRequireDefault(_utilsFileWriter),flatten=function(e){return[].concat.apply([],e)},middleIndex=0,gloabalIndex=0,maxTimes=0,localMaxTimes=0,itemResults=[],localResults=[],results=[],isDisplayProcess=_storeSettingsStore2["default"].getEachDisplay(),Shuffle=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"shuffleStart",value:function(e,t,r){var l=r;if(0>=t){var a=results.reduce(function(e,t){return e+t},"");return{deck:s,string:a}}0===r.length&&(l=this._createDeck(),maxTimes=t),gloabalIndex=maxTimes-t;var s=this._localShuffle(e,l);return results[results.length]=localResults.join(","),localResults=[],this.shuffleStart(e,t-1,s)}},{key:"_localShuffle",value:function(e,t){{var r=this,l=t;_storeSettingsStore2["default"].getEachDisplay()}return[].concat(_toConsumableArray(Array(e.length).keys())).forEach(function(t){var a=e[t];console.log("type: "+JSON.stringify(a)),middleIndex=t,l=r._shuffleRouter(a,l),console.log("_deck: ",JSON.stringify(l));var s=_utilsFileWriter2["default"].arrayToCsvString(l),n=_utilsFileWriter2["default"].createSettingsTemplate(a);localResults[localResults.length]=n+s}),l}},{key:"_shuffleRouter",value:function(e,t){console.log("condition: "+JSON.stringify(e));var r=e.shuffleType;if("cut"===r){var l=e.fromRange,a=e.toRange,s=e.startIsRandom,n=e.shuffleTimes;return this._cutShuffle(l,a,s,n,t)}if("hindu"===r){var l=e.fromRange,a=e.toRange,i=e.endFromRange,o=e.endToRange,s=e.startIsRandom,u=e.endIsRandom,n=e.shuffleTimes;return this._hinduShuffle(l,a,i,o,s,u,n,t)}if("faro"===r){var n=e.shuffleTimes;return this._faroShuffle(n,t)}if("deal"===r){var l=e.fromRange,a=e.toRange,s=e.startIsRandom,n=e.shuffleTimes;return this._dealShuffle(l,a,s,n,t)}}},{key:"_cutShuffle",value:function(e,t,r,l,a){var s=r?this._createRandom():this._createRandom(e,t),n=a.slice(0,s),i=a.slice(s).concat(n);itemResults.length<=0&&(localMaxTimes=l);var o=localMaxTimes-l;if(0>l-1)return itemResults=[],i;if(isDisplayProcess){console.log("cut isDisplay True!");var u="cut-"+gloabalIndex+"-"+middleIndex+"-"+o,f={shuffleType:"cut",fromRange:e,toRange:t,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(i,f,u)}return itemResults[itemResults.length]=o,this._cutShuffle(e,t,r,l-1,i)}},{key:"_hinduShuffle",value:function(e,t,r,l,a,s,n,i){console.log("isRandom: "+a);var o=a?this._createRandom():this._createRandom(e,t),u=s?this._createRandom():this._createRandom(r,l),f=o>u?"error!":"no error!";console.log("start: "+o),console.log("end: "+u),console.log("times: "+n),console.log("start > end: "+f);var c=localMaxTimes-n;if(0>=n)return itemResults=[],i;if(o>u)return console.log("やり直し！"),this._hinduShuffle(e,t,r,l,a,s,n,i);itemResults.length<=0&&(localMaxTimes=n);var m=i.slice(o-1,u),d=i.slice(u),h=i.slice(0,o-1),g=flatten([m,h,d]);if(console.log("hindu result: "+JSON.stringify(g)),isDisplayProcess){console.log("hindu isDisplay True!");var y="hindu-"+gloabalIndex+"-"+middleIndex+"-"+c,_={shuffleType:"hindu",fromRange:e,toRange:t,endFromRange:r,endToRange:l,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(g,_,y)}return itemResults[itemResults.length]=c,this._hinduShuffle(e,t,r,l,a,s,n-1,g)}},{key:"_faroShuffle",value:function(e,t){var r=t.length/2,l=t.slice(0,r),a=t.slice(r),s=[],n=0,i=0;itemResults.length<=0&&(localMaxTimes=e);for(var o=1;o<t.length+1;o++)1===o||o%2!==0?(s[o-1]=a[i],i++):(s[o-1]=l[n],n++);if(0>e-1)return itemResults=[],s;var u=localMaxTimes-e;if(isDisplayProcess){console.log("faro isDisplay True!");var f="faro-"+gloabalIndex+"-"+middleIndex+"-"+u,c={shuffleType:"faro",shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(s,c,f)}return itemResults[itemResults.length]=u,this._faroShuffle(e-1,s)}},{key:"_dealShuffle",value:function(e,t,r,l){var a=this,s=_createSubDeckNumber(e,t),n=(_createEmptyDecks(s),[]),i=l.length%s;if(itemResults.length<=0&&(localMaxTimes=r),1===s){if(l.reverse(),0>r-1)return itemResults=[],l;if(isDisplayProcess){console.log("deal isDisplay True!");var o="deal-"+gloabalIndex+"-"+middleIndex+"-"+index,u={shuffleType:"deal",fromRange:e,toRange:t,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(l,u,o)}return itemResults[itemResults.length]=index,this._dealShuffle(e,t,r-1,l)}if(n=[].concat(_toConsumableArray(Array(s).keys())).map(function(e){return a._getSubDeckIndex(e,s).map(function(e){return l[e]})}),i&&!function(){var e=l.length-i;[].concat(_toConsumableArray(Array(i).keys())).forEach(function(t){var r=n[t].length;n[t][r]=l[e],e++})}(),0>r-1)return itemResults=[],flatten(n);if(isDisplayProcess){console.log("deal2 isDisplay True!");var o="deal-"+gloabalIndex+"-"+middleIndex+"-"+index,u={shuffleType:"deal",fromRange:e,toRange:t,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(flatten(n),u,o)}return itemResults[itemResults.length]=index,this._dealShuffle(e,t,r-1,flatten(n))}},{key:"_createDeck",value:function(){var e=["spade","club","heart","dia"],t=flatten(e.map(function(e){return Array.from(Array(13).keys()).map(function(t){return{sute:e,number:t}})}));return t}},{key:"_createRandom",value:function(e,t){if(console.log("fromNum: "+e),console.log("toNum: "+t),void 0===e||void 0===t){var r=51*Math.random()+1;return console.log("result: "+r),Math.floor(r)}return Math.floor(Math.random()*(t-e)+e)}},{key:"_createEmptyDecks",value:function(e){return[].concat(_toConsumableArray(Array(e).keys())).map(function(e){return[]})}},{key:"_getSubDeckIndex",value:function(e,t){var r=deck.length/t;return[].concat(_toConsumableArray(Array(r+1).keys())).map(function(r){return e+t*r})}},{key:"_createSubDeckNumber",value:function(e,t){return"undefined"===from||"undefined"===to?7*Math.random()+1:Math.random()*(to-e)+e}}]),e}();exports["default"]=new Shuffle,module.exports=exports["default"];