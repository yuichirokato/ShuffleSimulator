"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,r,l){return r&&e(t.prototype,r),l&&e(t,l),t}}(),_storeSettingsStore=require("../store/SettingsStore"),_storeSettingsStore2=_interopRequireDefault(_storeSettingsStore),_utilsFileWriter=require("../utils/FileWriter"),_utilsFileWriter2=_interopRequireDefault(_utilsFileWriter),flatten=function(e){return[].concat.apply([],e)},middleIndex=0,gloabalIndex=0,maxTimes=0,localMaxTimes=0,itemResults=[],localResults=[],results=[],isDisplayProcess=_storeSettingsStore2["default"].getEachDisplay(),Shuffle=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"shuffleStart",value:function(e,t,r){var l=r;0===r.length&&(l=this._createDeck(),maxTimes=t),gloabalIndex=maxTimes-t;var a=this._localShuffle(e,l);if(0>t-1){var n=results.reduce(function(e,t){return e+t},"");return{deck:a,string:n}}return results[results.length]=localResults.join(","),localResults=[],this.shuffleStart(e,t-1,a)}},{key:"_localShuffle",value:function(e,t){{var r=this,l=t;_storeSettingsStore2["default"].getEachDisplay()}return[].concat(_toConsumableArray(Array(e.length).keys())).forEach(function(t){var a=e[t];console.log("type: "+JSON.stringify(a)),middleIndex=t,l=r._shuffleRouter(a,l);var n=_utilsFileWriter2["default"].arrayToCsvString(l),s=_utilsFileWriter2["default"].createSettingsTemplate(a);localResults[localResults.length]=s+n}),l}},{key:"_shuffleRouter",value:function(e,t){console.log("condition: "+JSON.stringify(e));var r=e.shuffleType;if("cut"===r||"deal"===r){var l=e.fromRange,a=e.toRange,n=e.startIsRandom,s=e.shuffleTimes;return this._cutShuffle(l,a,n,s,t)}if("hindu"===r){var l=e.fromRange,a=e.toRange,i=e.endFromRange,u=e.endToRange,n=e.startIsRandom,o=e.endIsRandom,s=e.shuffleTimes;return this._hinduShuffle(l,a,i,u,n,o,s,t)}if("faro"===r){var s=e.shuffleTimes;return this._faroShuffle(s,t)}}},{key:"_cutShuffle",value:function(e,t,r,l,a){var n=r?this._createRandom():this._createRandom(e,t),s=a.slice(0,n),i=a.slice(n).concat(s);itemResults.length<=0&&(localMaxTimes=l);var u=localMaxTimes-l;if(0>l-1)return itemResults=[],i;if(isDisplayProcess){var o="cut-"+gloabalIndex+"-"+middleIndex+"-"+u,f={shuffleType:"cut",fromRange:e,toRange:t,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(i,f,o)}return itemResults[itemResults.length]=u,this._cutShuffle(e,t,r,l-1,i)}},{key:"_hinduShuffle",value:function(e,t,r,l,a,n,s,i){var u=a?this._createRandom():this._createRandom(e,t),o=n?this._createRandom():this._createRandom(r,l);if(u>=o)return this._hinduShuffle(e,t,r,l,a,n,s,i);itemResults.length<=0&&(localMaxTimes=s);var f=i.slice(u,o),c=i.slice(o),m=i.slice(0,u-1),d=[f,m,c].flatten(),h=localMaxTimes-s;if(0>s-1)return itemResults=[],d;if(isDisplayProcess){var g="hindu-"+gloabalIndex+"-"+middleIndex+"-"+h,_={shuffleType:"hindu",fromRange:e,toRange:t,endFromRange:r,endToRange:l,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(d,_,g)}return itemResults[itemResults.length]=h,this._hinduShuffle(e,t,r,l,a,n,s-1,d)}},{key:"_faroShuffle",value:function(e,t){var r=t.length/2,l=t.slice(0,r),a=t.slice(r),n=[],s=0,i=0;itemResults.length<=0&&(localMaxTimes=e);for(var u=1;u<t.length+1;u++)1===u||u%2!==0?(n[u-1]=a[i],i++):(n[u-1]=l[s],s++);if(0>e-1)return itemResults=[],n;var o=localMaxTimes-e;if(isDisplayProcess){var f="faro-"+gloabalIndex+"-"+middleIndex+"-"+o,c={shuffleType:"faro",shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(n,c,f)}return itemResults[itemResults.length]=o,this._faroShuffle(e-1,n)}},{key:"_dealShuffle",value:function(e,t,r,l){var a=_createSubDeckNumber(e,t),n=(_createEmptyDecks(a),[]),s=l.length%a;if(itemResults.length<=0&&(localMaxTimes=r),1===a){if(l.reverse(),0>r-1)return itemResults=[],l;if(isDisplayProcess){var i="deal-"+gloabalIndex+"-"+middleIndex+"-"+index,u={shuffleType:"deal",fromRange:e,toRange:t,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(l,u,i)}return itemResults[itemResults.length]=index,this._dealShuffle(e,t,r-1,l)}if(n=[].concat(_toConsumableArray(Array(a).keys())).map(function(e){return getSubDeckIndex(e,a).map(function(e){return l[e]})}),s&&!function(){var e=l.length-s;[].concat(_toConsumableArray(Array(s).keys())).forEach(function(t){var r=n[t].length;n[t][r]=l[e],e++})}(),0>r-1)return itemResults=[],flatten(n);if(isDisplayProcess){var i="deal-"+gloabalIndex+"-"+middleIndex+"-"+index,u={shuffleType:"deal",fromRange:e,toRange:t,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(flatten(n),u,i)}return itemResults[itemResults.length]=index,this._dealShuffle(e,t,r-1,flatten(n))}},{key:"_createDeck",value:function(){var e=["spade","club","heart","dia"],t=flatten(e.map(function(e){return Array.from(Array(13).keys()).map(function(t){return{sute:e,number:t}})}));return t}},{key:"_createRandom",value:function(e,t){return"undefined"===e||"undefined"===t||e===t?51*Math.random()+1:Math.random()*(t-e)+e}},{key:"_createEmptyDecks",value:function(e){return[].concat(_toConsumableArray(Array(e).keys())).map(function(e){return[]})}},{key:"_getSubDeckIndex",value:function(e,t){var r=deck.length/t;return[].concat(_toConsumableArray(Array(r+1).keys())).map(function(r){return e+t*r})}},{key:"_createSubDeckNumber",value:function(e,t){return"undefined"===from||"undefined"===to||e===t?7*Math.random()+1:Math.random()*(to-e)+e}}]),e}();exports["default"]=new Shuffle,module.exports=exports["default"];