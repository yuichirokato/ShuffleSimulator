"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_storeSettingsStore=require("../store/SettingsStore"),_storeSettingsStore2=_interopRequireDefault(_storeSettingsStore),_utilsFileWriter=require("../utils/FileWriter"),_utilsFileWriter2=_interopRequireDefault(_utilsFileWriter),flatten=function(e){return[].concat.apply([],e)},middleIndex=0,gloabalIndex=0,maxTimes=0,localMaxTimes=0,itemResults=[],localResults=[],results=[],isDisplayProcess=_storeSettingsStore2["default"].getEachDisplay(),Shuffle=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"shuffleStart",value:function(e,t,r){var a=r;if(0>=t){var l=results.reduce(function(e,t){return e+t},"");return{deck:s,string:l}}0===r.length&&(a=this._createDeck(),maxTimes=t),gloabalIndex=maxTimes-t;var s=this._localShuffle(e,a);return results[results.length]=localResults.join(","),localResults=[],this.shuffleStart(e,t-1,s)}},{key:"_localShuffle",value:function(e,t){{var r=this,a=t;_storeSettingsStore2["default"].getEachDisplay()}return[].concat(_toConsumableArray(Array(e.length).keys())).forEach(function(t){var l=e[t];console.log("type: "+JSON.stringify(l)),middleIndex=t,a=r._shuffleRouter(l,a);var s=_utilsFileWriter2["default"].arrayToCsvString(a),n=_utilsFileWriter2["default"].createSettingsTemplate(l);localResults[localResults.length]=n+s}),a}},{key:"_shuffleRouter",value:function(e,t){console.log("condition: "+JSON.stringify(e));var r=e.shuffleType;if("cut"===r){var a=e.fromRange,l=e.toRange,s=e.startIsRandom,n=e.shuffleTimes;return this._cutShuffle(a,l,s,n,t)}if("hindu"===r){var a=e.fromRange,l=e.toRange,i=e.endFromRange,u=e.endToRange,s=e.startIsRandom,o=e.endIsRandom,n=e.shuffleTimes;return this._hinduShuffle(a,l,i,u,s,o,n,t)}if("faro"===r){var n=e.shuffleTimes;return this._faroShuffle(n,t)}if("deal"===r){var a=e.fromRange,l=e.toRange,s=e.startIsRandom,n=e.shuffleTimes;return this._dealShuffle(a,l,s,n,t)}}},{key:"_cutShuffle",value:function(e,t,r,a,l){if(0>=a)return itemResults=[],l;var s=r?this._createRandom():this._createRandom(e,t),n=l.slice(0,s),i=l.slice(s).concat(n);itemResults.length<=0&&(localMaxTimes=a);var u=localMaxTimes-a;if(isDisplayProcess){var o="cut-"+gloabalIndex+"-"+middleIndex+"-"+u,f={shuffleType:"cut",fromRange:e,toRange:t,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(i,f,o)}return itemResults[itemResults.length]=u,this._cutShuffle(e,t,r,a-1,i)}},{key:"_hinduShuffle",value:function(e,t,r,a,l,s,n,i){if(0>=n)return itemResults=[],i;var u=l?this._createRandom():this._createRandom(e,t),o=s?this._createRandom():this._createRandom(r,a);if(u>o)return this._hinduShuffle(e,t,r,a,l,s,n,i);itemResults.length<=0&&(localMaxTimes=n);var f=localMaxTimes-n,c=i.slice(u-1,o),h=i.slice(o),m=i.slice(0,u-1),d=flatten([c,m,h]);if(isDisplayProcess){var g="hindu-"+gloabalIndex+"-"+middleIndex+"-"+f,_={shuffleType:"hindu",fromRange:e,toRange:t,endFromRange:r,endToRange:a,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(d,_,g)}return itemResults[itemResults.length]=f,this._hinduShuffle(e,t,r,a,l,s,n-1,d)}},{key:"_faroShuffle",value:function(e,t){if(0>=e)return itemResults=[],t;var r=t.length/2,a=t.slice(0,r),l=t.slice(r),s=[],n=0,i=0;itemResults.length<=0&&(localMaxTimes=e);for(var u=1;u<t.length+1;u++)1===u||u%2!==0?(s[u-1]=l[i],i++):(s[u-1]=a[n],n++);s.reverse();var o=localMaxTimes-e;if(isDisplayProcess){var f="faro-"+gloabalIndex+"-"+middleIndex+"-"+o,c={shuffleType:"faro",shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(s,c,f)}return itemResults[itemResults.length]=o,this._faroShuffle(e-1,s)}},{key:"_dealShuffle",value:function(e,t,r,a,l){var s=this;if(0>=a)return itemResults=[],flatten(l);var n=r?this._createRandom():this._createRandom(e,t),i=(this._createEmptyDecks(n),l.length%n);if(itemResults.length<=0&&(localMaxTimes=a),1===n){if(l.reverse(),isDisplayProcess){var u="deal-"+gloabalIndex+"-"+middleIndex+"-"+f,o={shuffleType:"deal",fromRange:e,toRange:t,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(l,o,u)}var f=localMaxTimes-a;return itemResults[itemResults.length]=f,this._dealShuffle(e,t,r,a-1,l)}var c=[].concat(_toConsumableArray(Array(n).keys())).map(function(e){return s._getSubDeckIndex(e,n,l).map(function(e){return l[e]})});if(i&&!function(){var e=l.length-i;[].concat(_toConsumableArray(Array(i).keys())).forEach(function(t){var r=c[t].length;c[t][r]=l[e],e++})}(),c.forEach(function(e){return e.reverse()}),isDisplayProcess){var u="deal-"+gloabalIndex+"-"+middleIndex+"-"+h,o={shuffleType:"deal",fromRange:e,toRange:t,shuffleTimes:localMaxTimes};_utilsFileWriter2["default"].writeProcess(flatten(c),o,u)}var h=localMaxTimes-a;return itemResults[itemResults.length]=h,this._dealShuffle(e,t,r,a-1,flatten(c))}},{key:"_createDeck",value:function(){var e=["spade","club","heart","dia"],t=flatten(e.map(function(e){return Array.from(Array(13).keys()).map(function(t){return{sute:e,number:t+1}})}));return t}},{key:"_createRandom",value:function(e,t){var r=parseInt(e,10),a=parseInt(t,10);if(void 0===e||void 0===t){var l=Math.floor(51*Math.random()+1);return l}var s=Math.floor(Math.random()*(a-r)+r);return s}},{key:"_createEmptyDecks",value:function(e){return[].concat(_toConsumableArray(Array(e).keys())).map(function(e){return[]})}},{key:"_getSubDeckIndex",value:function(e,t,r){var a=Math.floor(r.length/t),l=[].concat(_toConsumableArray(Array(a).keys())).map(function(r){return e+t*r});return l}}]),e}();exports["default"]=new Shuffle,module.exports=exports["default"];